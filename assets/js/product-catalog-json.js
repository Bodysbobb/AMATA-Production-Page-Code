const URL_CLICKS_KEY="product_url_clicks",LIGHTBOX_OPENS_KEY="product_lightbox_opens",SUPABASE_URL="https://twvwpdzcgtgyysxntill.supabase.co",SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR3dndwZHpjZ3RneXlzeG50aWxsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY3NTg1MjUsImV4cCI6MjA2MjMzNDUyNX0.8PMguWXxjTZ_9Fjn-mlNIQ01bBLJvVHHN00_R7oWl7c";function getThailandTimestamp(){const t=new Date,e=t.getTime()+6e4*t.getTimezoneOffset();return new Date(e+252e5).toISOString()}function createCleanUrlSlug(t){return t.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}const productAnalytics={getProductCategory:function(t){const e=t.toLowerCase();return e.includes("sports")?"กีฬา":e.includes("polo")?"เสื้อโปโล":e.includes("tshirt")?"เสื้อยืด":e.includes("printing")?"สิ่งพิมพ์":"อื่นๆ"},trackUrlClick:function(t){let e=this.getUrlClickData();return e[t]||(e[t]={clicks:0,lastClicked:null}),e[t].clicks++,e[t].lastClicked=(new Date).toISOString(),localStorage.setItem(URL_CLICKS_KEY,JSON.stringify(e)),fetch(`${SUPABASE_URL}/rest/v1/product_clicks`,{method:"POST",headers:{"Content-Type":"application/json",apikey:SUPABASE_ANON_KEY,Authorization:`Bearer ${SUPABASE_ANON_KEY}`,Prefer:"return=minimal"},body:JSON.stringify([{product_id:t,type:"urlClick",category:this.getProductCategory(t),count:1,timestamp:getThailandTimestamp()}])}).catch((t=>console.error("Error sending to Supabase:",t))),e[t].clicks},trackLightboxOpen:function(t){let e=this.getLightboxOpenData();return e[t]||(e[t]={opens:0,lastOpened:null}),e[t].opens++,e[t].lastOpened=(new Date).toISOString(),localStorage.setItem(LIGHTBOX_OPENS_KEY,JSON.stringify(e)),fetch(`${SUPABASE_URL}/rest/v1/product_clicks`,{method:"POST",headers:{"Content-Type":"application/json",apikey:SUPABASE_ANON_KEY,Authorization:`Bearer ${SUPABASE_ANON_KEY}`,Prefer:"return=minimal"},body:JSON.stringify([{product_id:t,type:"lightboxOpen",category:this.getProductCategory(t),count:1,timestamp:getThailandTimestamp()}])}).catch((t=>console.error("Error sending to Supabase:",t))),e[t].opens},getUrlClickData:function(){const t=localStorage.getItem(URL_CLICKS_KEY);return t?JSON.parse(t):{}},getLightboxOpenData:function(){const t=localStorage.getItem(LIGHTBOX_OPENS_KEY);return t?JSON.parse(t):{}}};function initFilters(t,e){if(e.ui.show_top_filters||e.ui.show_dropdown_filters){if(!1!==e.ui.show_top_filters){const o=t.querySelector(".top-filter-tags");if(o){o.innerHTML="";const t=document.createElement("a");t.href="#",t.className="filter-tag active",t.setAttribute("data-filter","all"),t.textContent="All",o.appendChild(t),e.topFilters.forEach((t=>{const e=document.createElement("a");e.href="#",e.className="filter-tag",e.setAttribute("data-filter",t.value),e.textContent=t.display,o.appendChild(e)}))}}else{const e=t.querySelector(".top-filter-tags-wrapper");e&&(e.style.display="none")}if(!1!==e.ui.show_dropdown_filters){const o=t.querySelector(".filter-sort-button");o&&(o.textContent=e.ui.labels.filter_button||"Filter & Sort");const n=t.querySelector(".filter-dropdown");if(n){Object.entries(e.filters).forEach((([t,e])=>{const o=document.createElement("div");o.className="filter-category";const i=document.createElement("div");i.className="category-header";const l=document.createElement("h4");l.className="category-title",l.textContent=e.label;const a=document.createElement("button");a.className="toggle-category",a.setAttribute("aria-label","Toggle category"),a.innerHTML='<span class="arrow-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></span>',i.appendChild(l),i.appendChild(a);const c=document.createElement("div");c.className="category-filters hidden",e.values.forEach((t=>{const e=document.createElement("a");e.href="#",e.className="dropdown-filter-tag",e.setAttribute("data-filter",t.value),e.textContent=t.display,c.appendChild(e)})),o.appendChild(i),o.appendChild(c);const r=n.querySelector(".selected-filters");r?n.insertBefore(o,r):n.appendChild(o)}));const o=t.querySelector(".selected-filters h4");o&&(o.textContent=e.ui.labels.selected_filters||"Selected Filters");const i=t.querySelector(".selected-filters-list");i&&(i.innerHTML=`<span class="no-filters">${e.ui.labels.no_filters||"No filters selected"}</span>`);const l=t.querySelector(".clear-all-filters");l&&(l.textContent=e.ui.labels.clear_all||"Clear All")}}else{const e=t.querySelector(".filter-sort");e&&(e.style.display="none")}setupEventListeners(t)}else{const e=t.querySelector(".catalog-filters");e&&(e.style.display="none")}}function setupEventListeners(t){t.querySelectorAll(".category-header").forEach((t=>{t.addEventListener("click",(function(){const t=this.nextElementSibling,e=this.querySelector(".arrow-icon");t&&e&&(t.classList.toggle("hidden"),e.classList.toggle("rotated"))}))}));const e=t.querySelector(".filter-sort-button"),o=t.querySelector(".filter-dropdown");e&&o&&(e.addEventListener("click",(function(){o.classList.toggle("active"),this.classList.toggle("active")})),document.addEventListener("click",(function(t){!t.target.closest(".filter-sort")&&o.classList.contains("active")&&(o.classList.remove("active"),e.classList.remove("active"))}))),t.addEventListener("click",(function(e){const o=e.target;if(o.closest(".product-link")){e.preventDefault();const t=o.closest(".product-link"),n=parseInt(t.getAttribute("data-index"),10);!isNaN(n)&&window.productCatalog.data&&createLightbox(window.productCatalog.data,n)}else if(o.matches(".filter-tag, .dropdown-filter-tag")){e.preventDefault();const n=o.getAttribute("data-filter");o.classList.contains("filter-tag")?"all"===n?window.productCatalog.activeFilters=[]:window.productCatalog.activeFilters.includes(n)?removeFilter(n):addFilter(n):addFilter(n),updateSelectedFilters(t),applyFilters(t)}else if(o.classList.contains("remove-filter")){const e=o.closest(".filter-badge");e&&(removeFilter(e.dataset.filter),updateSelectedFilters(t),applyFilters(t))}}));const n=t.querySelector(".clear-all-filters");n&&n.addEventListener("click",(function(){window.productCatalog.activeFilters=[],updateSelectedFilters(t),applyFilters(t)}))}function addFilter(t){window.productCatalog.activeFilters.includes(t)||window.productCatalog.activeFilters.push(t)}function removeFilter(t){window.productCatalog.activeFilters=window.productCatalog.activeFilters.filter((e=>e!==t))}function updateSelectedFilters(t){const e=window.productCatalog.data,o=t.querySelector(".selected-filters-list");o&&e&&(0!==window.productCatalog.activeFilters.length?(o.innerHTML="",window.productCatalog.activeFilters.forEach((t=>{let n=t;for(const o in e.filters){const i=e.filters[o].values.find((e=>e.value===t));if(i){n=i.display;break}}const i=document.createElement("span");i.className="filter-badge",i.dataset.filter=t,i.innerHTML=`${n} <span class="remove-filter">&times;</span>`,o.appendChild(i)}))):o.innerHTML=`<span class="no-filters">${e.ui.labels.no_filters||"No filters selected"}</span>`)}function applyFilters(t){t.querySelectorAll(".filter-tag").forEach((t=>{const e=t.getAttribute("data-filter");"all"===e?t.classList.toggle("active",0===window.productCatalog.activeFilters.length):t.classList.toggle("active",window.productCatalog.activeFilters.includes(e))})),t.querySelectorAll(".dropdown-filter-tag").forEach((t=>{const e=t.getAttribute("data-filter");t.classList.toggle("active",window.productCatalog.activeFilters.includes(e))}));const e=t.querySelectorAll(".product-item");0!==window.productCatalog.activeFilters.length?e.forEach((t=>{const e=(t.getAttribute("data-tags")||"").toLowerCase();let o=!1;for(let t=0;t<window.productCatalog.activeFilters.length;t++)if(e&&e.includes(window.productCatalog.activeFilters[t].toLowerCase())){o=!0;break}t.style.display=o?"block":"none"})):e.forEach((t=>{t.style.display="block"}))}function checkUrlForLightbox(){const t=new URLSearchParams(window.location.search).get("product");if(t&&window.productCatalog&&window.productCatalog.data){const e=window.productCatalog.data.products.findIndex((e=>createCleanUrlSlug(e.description)===t));-1!==e&&setTimeout((()=>{createLightbox(window.productCatalog.data,e)}),500)}}function createLightbox(t,e){const o=t.products[e],n=t.ui;productAnalytics.trackLightboxOpen(o.description),window.productCatalog.currentLightboxIndex=e;const i=document.createElement("div");i.className="lightbox";const l=document.createElement("div");l.className="lightbox-content";const a=document.createElement("div");a.className="lightbox-image-wrapper";const c=document.createElement("img");c.src=o.path,c.alt=o.alt;const r=document.createElement("span");r.className="lightbox-close",r.innerHTML="&times;",r.setAttribute("aria-label","Close"),r.addEventListener("click",closeLightbox);const s=document.createElement("div");if(s.className="lightbox-caption",s.textContent=o.description,n.show_copy_url){const t=document.createElement("div");t.className="lightbox-share";const e=document.createElement("div");e.className="share-message",e.textContent=n.labels.copy_message;const i=document.createElement("button");i.className="copy-link-button",i.textContent=n.labels.copy_button;const l=document.createElement("div");if(l.className="middle-label",l.textContent=n.labels.middle_label||"",l.style.display="none",i.addEventListener("click",(function(){const e=createCleanUrlSlug(o.description),a=window.location.origin+window.location.pathname+"?product="+e;productAnalytics.trackUrlClick(o.description),navigator.clipboard.writeText(a).then((()=>{i.textContent=n.labels.copy_button_final,l.style.display="inline-block";const e=t.querySelector(".line-button");e&&(e.style.display="inline-flex"),setTimeout((()=>{i.textContent=n.labels.copy_button}),2e3)})).catch((()=>{const e=document.createElement("textarea");e.value=a,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),i.textContent=n.labels.copy_button_final,l.style.display="inline-block";const e=t.querySelector(".line-button");e&&(e.style.display="inline-flex"),setTimeout((()=>{i.textContent=n.labels.copy_button}),2e3)}catch(t){console.error("Could not copy text: ",t)}document.body.removeChild(e)}))})),t.appendChild(e),t.appendChild(i),t.appendChild(l),n.line_account){const e=document.createElement("a");e.className="line-button",e.href=n.line_account,e.target="_blank",e.rel="noopener noreferrer",e.style.display="none",e.innerHTML='<svg class="line-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M272.1 204.2v71.1c0 1.8-1.4 3.2-3.2 3.2h-11.4c-1.1 0-2.1-.6-2.6-1.3l-32.6-44v42.2c0 1.8-1.4 3.2-3.2 3.2h-11.4c-1.8 0-3.2-1.4-3.2-3.2v-71.1c0-1.8 1.4-3.2 3.2-3.2H219c1 0 2.1.5 2.6 1.4l32.6 44v-42.2c0-1.8 1.4-3.2 3.2-3.2h11.4c1.8-.1 3.3 1.4 3.3 3.1zm-82-3.2h-11.4c-1.8 0-3.2 1.4-3.2 3.2v71.1c0 1.8 1.4 3.2 3.2 3.2h11.4c1.8 0 3.2-1.4 3.2-3.2v-71.1c0-1.7-1.4-3.2-3.2-3.2zm-27.5 59.6h-31.1v-56.4c0-1.8-1.4-3.2-3.2-3.2h-11.4c-1.8 0-3.2 1.4-3.2 3.2v71.1c0 .9.3 1.6.9 2.2.6.5 1.3.9 2.2.9h45.7c1.8 0 3.2-1.4 3.2-3.2v-11.4c0-1.7-1.4-3.2-3.1-3.2zM332.1 201h-45.7c-1.7 0-3.2 1.4-3.2 3.2v71.1c0 1.7 1.4 3.2 3.2 3.2h45.7c1.8 0 3.2-1.4 3.2-3.2v-11.4c0-1.8-1.4-3.2-3.2-3.2H301v-12h31.1c1.8 0 3.2-1.4 3.2-3.2V234c0-1.8-1.4-3.2-3.2-3.2H301v-12h31.1c1.8 0 3.2-1.4 3.2-3.2v-11.4c-.1-1.7-1.5-3.2-3.2-3.2zM448 113.7V399c-.1 44.8-36.8 81.1-81.7 81H81c-44.8-.1-81.1-36.9-81-81.7V113c.1-44.8 36.9-81.1 81.7-81H367c44.8.1 81.1 36.8 81 81.7zm-61.6 122.6c0-73-73.2-132.4-163.1-132.4-89.9 0-163.1 59.4-163.1 132.4 0 65.4 58 120.2 136.4 130.6 19.1 4.1 16.9 11.1 12.6 36.8-.7 4.1-3.3 16.1 14.1 8.8 17.4-7.3 93.9-55.3 128.2-94.7 23.6-26 34.9-52.3 34.9-81.5z"/></svg>LINE',t.appendChild(e)}a.appendChild(t)}if(a.appendChild(c),l.appendChild(r),l.appendChild(a),l.appendChild(s),n.size_guide&&n.size_content&&n.size_picture){const t=document.createElement("div");t.className="lightbox-size-guide";const e=document.createElement("a");e.className="size-guide-link",e.href=n.size_picture,e.target="_blank",e.rel="noopener noreferrer",e.textContent=n.size_content,t.appendChild(e),l.appendChild(t)}if(i.appendChild(l),t.products.length>1){const o=document.createElement("div");o.className="lightbox-nav lightbox-prev",o.innerHTML="&#10094;",o.setAttribute("aria-label","Previous image"),o.addEventListener("click",(function(o){o.stopPropagation(),navigateLightbox((e-1+t.products.length)%t.products.length)}));const n=document.createElement("div");n.className="lightbox-nav lightbox-next",n.innerHTML="&#10095;",n.setAttribute("aria-label","Next image"),n.addEventListener("click",(function(o){o.stopPropagation(),navigateLightbox((e+1)%t.products.length)})),i.appendChild(o),i.appendChild(n)}document.addEventListener("keydown",keyboardNavigation),i.addEventListener("click",(function(t){t.target===i&&closeLightbox()})),document.body.appendChild(i),document.body.style.overflow="hidden"}function closeLightbox(){document.removeEventListener("keydown",keyboardNavigation);const t=document.querySelector(".lightbox");t&&(t.style.opacity="0",t.style.transition="opacity 0.3s ease",setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t),document.body.style.overflow=""}),300))}function navigateLightbox(t){closeLightbox(),setTimeout((()=>{createLightbox(window.productCatalog.data,t)}),300)}function keyboardNavigation(t){"Escape"===t.key?closeLightbox():"ArrowLeft"===t.key?(t.preventDefault(),navigateLightbox((window.productCatalog.currentLightboxIndex-1+window.productCatalog.data.products.length)%window.productCatalog.data.products.length)):"ArrowRight"===t.key&&(t.preventDefault(),navigateLightbox((window.productCatalog.currentLightboxIndex+1)%window.productCatalog.data.products.length))}document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".product-catalog[data-json-url]").forEach((function(t){if(window.productCatalog&&window.productCatalog.data)initFilters(t,window.productCatalog.data),checkUrlForLightbox();else{const e=setInterval((function(){window.productCatalog&&window.productCatalog.data&&(clearInterval(e),initFilters(t,window.productCatalog.data),checkUrlForLightbox())}),100);setTimeout((function(){clearInterval(e)}),5e3)}}))}));